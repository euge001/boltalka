<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#111827" />
  <link rel="manifest" href="./manifest.webmanifest" />
  <title>Voice Bot (Realtime)</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { background:#0b1220; color:#e5e7eb; }
    .card { background:#0f172a; border-color:#1f2937; }
    pre { max-height: 45vh; overflow:auto; background:#050a14; padding:12px; border-radius:10px; }
    .muted { color:#9ca3af; }
    code { color:#a7f3d0; }
    @keyframes pulsate {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }
    .pulsate { animation: pulsate 1.5s infinite; }
  </style>
</head>
<body class="p-3 p-md-4">
  <div class="container" style="max-width:900px">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <h1 class="h4 m-0">Voice Bot <span class="muted">(Realtime WebRTC)</span></h1>
      <span id="status" class="badge text-bg-secondary">idle</span>
    </div>

    <div class="card p-3 mb-3">
      <div class="d-flex gap-2 flex-wrap align-items-center">
        <div class="btn-group">
          <button id="btnConnect" class="btn btn-success">Connect</button>
          <button id="btnVAD" class="btn btn-outline-info dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
            ğŸ™ï¸ Auto Mode
          </button>
          <ul id="vadMenu" class="dropdown-menu dropdown-menu-dark">
            <li><a class="dropdown-item active" href="#" data-vad="server_vad">Auto (VAD)</a></li>
            <li><a class="dropdown-item" href="#" data-vad="manual">Manual (Push-to-Talk)</a></li>
          </ul>
        </div>
        <button id="btnMute" class="btn btn-outline-danger" disabled>Talk</button>
        <button id="btnDisconnect" class="btn btn-outline-light" disabled>Disconnect</button>
        <button id="btnClear" class="btn btn-outline-warning">Clear Log</button>
        <a href="coder.html" class="btn btn-info">Coder Expert</a>
        
        <!-- Language Selector -->
        <select id="languageSelect" class="form-select form-select-sm" style="width: auto; max-width: 150px;">
          <option value="en">ğŸŒ English</option>
          <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
          <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
          <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
          <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
        </select>
        
        <!-- Model Selector -->
        <select id="modelSelect" class="form-select form-select-sm" style="width: auto; max-width: 180px;">
          <option value="gpt-4o-mini-realtime-preview">ğŸ¤– gpt-4o-mini (Fast)</option>
          <option value="gpt-4o-realtime-preview">âš¡ gpt-4o (Smart)</option>
        </select>
      </div>

      <div class="mt-3 muted">
        Classic Voice Bot. Just speak and AI responds with audio. Switch between Auto (VAD) and Manual (Push-to-Talk) modes.
      </div>

      <audio id="remoteAudio" autoplay playsinline></audio>
    </div>

    <div class="card p-3 mb-3">
      <label class="form-label">Text Chat (Optional)</label>
      <div class="input-group">
        <input id="txt" class="form-control" placeholder="Type and send text messageâ€¦" />
        <button id="btnSend" class="btn btn-primary" disabled>Send</button>
      </div>
      <div class="muted mt-2">
        Sends via: <code>conversation.item.create</code> â†’ <code>response.create</code>.
      </div>
    </div>

    <details class="mb-4">
      <summary class="muted cursor-pointer" style="cursor:pointer">Technical Event Log (Debug)</summary>
      <pre id="log" class="mt-2" style="max-height: 300px; overflow: auto;"></pre>
    </details>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="./configService.js?v=1.0"></script>
  <script src="./app.js?v=9.0"></script>
  <script>
    // Force unregister service worker to clear cache issues
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.getRegistrations().then(registrations => {
        for (let registration of registrations) { registration.unregister(); }
      });
    }
  </script>
</body>
</html>
